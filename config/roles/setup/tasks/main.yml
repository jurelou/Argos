- name: "Install dependencies"
  apt: pkg={{ item }} update_cache=yes
  with_items:
    - git
    - curl
    - apt-transport-https
    - ca-certificates
    - curl
    - software-properties-common

- name: "Copy configuration files"
  copy:
    src: /opt/HoneyPy/config/files/
    dest: /opt/

- name: "Copy handlers"
  copy:
    src: /opt/HoneyPy/handlers/
    dest: /opt/

- name: "Add Docker GPG key"
  apt_key: url=https://download.docker.com/linux/ubuntu/gpg

- name: "Add Docker APT repository"
  apt_repository:
    repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ansible_distribution_release}} stable

- name: "Install Docker"
  apt:     name=docker-ce

- name: "Add user to docker group"
  command: "{{ item }}"
  with_items:
    - groupadd docker
    - usermod -aG docker redteam

- name: "Install filebeat"
  command: "{{ item }}"
  with_items:
    - cd /opt
    - curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.3.1-amd64.deb
    - dpkg -i filebeat-6.3.1-amd64.deb

- name: "Create filebeat logs directory"
  file: path=/var/log/beat state=directory

- name: "Overwrite filebeat configuration file"
  shell: cat /opt/files/filebeat.yml > /etc/filebeat/filebeat.yml
  notify:
     - restart-filebeat
